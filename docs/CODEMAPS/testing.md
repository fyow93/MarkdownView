# ğŸ§ª Testing Codemap

> Last Updated: 2025-01-26

æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•äº†é¡¹ç›®çš„æµ‹è¯•ç­–ç•¥ã€è¦†ç›–ç‡å’Œæµ‹è¯•æ–‡ä»¶ç»“æ„ã€‚

## ğŸ“Š æµ‹è¯•æ¦‚è§ˆ

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ€»æµ‹è¯•æ•° | 140 |
| æµ‹è¯•æ–‡ä»¶æ•° | 12 |
| æµ‹è¯•é€šè¿‡ç‡ | 100% |
| æµ‹è¯•æ¡†æ¶ | Vitest |

## ğŸ“‹ æµ‹è¯•æ–‡ä»¶åˆ—è¡¨

### Hooks æµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•æ•° | è¦†ç›–æ¨¡å— |
|----------|--------|----------|
| `src/hooks/__tests__/useMarkdownLoader.test.ts` | 12 | TOCç”Ÿæˆã€æ ‡é¢˜IDç”Ÿæˆ |
| `src/hooks/__tests__/useScrollPosition.test.ts` | 8 | æ»šåŠ¨è¿½è¸ªã€è¿”å›é¡¶éƒ¨ |
| `src/hooks/__tests__/useKeyboardShortcuts.test.ts` | 11 | å¿«æ·é”®å¤„ç† |
| `src/hooks/__tests__/useCopilotSessions.test.ts` | 5 | ä¼šè¯ç®¡ç† |
| `src/hooks/__tests__/useCopilotSessionWatch.test.ts` | 10 | ä¼šè¯å®æ—¶ç›‘æ§ |
| `src/hooks/__tests__/useFileWatch.test.ts` | 11 | SSEæ–‡ä»¶å˜æ›´ç›‘æ§ |

### ç»„ä»¶æµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•æ•° | è¦†ç›–æ¨¡å— |
|----------|--------|----------|
| `src/components/markdown/__tests__/StateComponents.test.tsx` | 14 | çŠ¶æ€ç»„ä»¶ |
| `src/components/markdown/__tests__/BackToTopButton.test.tsx` | 6 | è¿”å›é¡¶éƒ¨æŒ‰é’® |
| `src/components/__tests__/MarkdownViewer.test.tsx` | 7 | ä¸»æŸ¥çœ‹å™¨ç»„ä»¶ |

### åº“å‡½æ•°æµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•æ•° | è¦†ç›–æ¨¡å— |
|----------|--------|----------|
| `src/lib/__tests__/copilot-session.test.ts` | 12 | ä¼šè¯è§£æã€è·¯å¾„éªŒè¯ |
| `src/lib/__tests__/utils.test.ts` | 14 | encodeFilePath, buildFileApiUrl |

## ğŸ—ï¸ æµ‹è¯•æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Test Architecture                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   Test Runner                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚              Vitest 4.0.18                   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  - Fast execution with HMR                  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  - Native ESM support                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  - Compatible with Jest API                 â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                                â”‚
â”‚                             â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  Test Utilities                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚ @testing-library â”‚  â”‚     vitest-dom       â”‚     â”‚    â”‚
â”‚  â”‚  â”‚     /react       â”‚  â”‚                      â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚   happy-dom      â”‚  â”‚     vitest/ui        â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  (DOM emulation) â”‚  â”‚   (UI interface)     â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                                â”‚
â”‚                             â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   Test Types                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚    Unit     â”‚ â”‚ Integration â”‚ â”‚  Component  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚   Tests     â”‚ â”‚   Tests     â”‚ â”‚    Tests    â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  (hooks,    â”‚ â”‚  (API +     â”‚ â”‚  (render +  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚   utils)    â”‚ â”‚   hooks)    â”‚ â”‚   events)   â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æµ‹è¯•é…ç½®

### vitest.config.ts

```typescript
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';
import tsconfigPaths from 'vite-tsconfig-paths';

export default defineConfig({
  plugins: [react(), tsconfigPaths()],
  test: {
    environment: 'happy-dom',
    setupFiles: ['./vitest.setup.ts'],
    include: ['src/**/*.{test,spec}.{ts,tsx}'],
    globals: true,
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
    },
  },
});
```

### vitest.setup.ts

```typescript
import '@testing-library/jest-dom';
```

## ğŸ“ æµ‹è¯•æ¨¡å¼

### 1. çº¯å‡½æ•°æµ‹è¯•

ç”¨äºæµ‹è¯•æ— å‰¯ä½œç”¨çš„å·¥å…·å‡½æ•°å’Œæ•°æ®è½¬æ¢é€»è¾‘ã€‚

```typescript
// ç¤ºä¾‹: useMarkdownLoader.test.ts
describe('generateHeadingId', () => {
  it('should convert text to lowercase kebab-case', () => {
    expect(generateHeadingId('Hello World')).toBe('hello-world');
  });

  it('should handle Chinese characters', () => {
    expect(generateHeadingId('ä¸­æ–‡æ ‡é¢˜')).toBe('ä¸­æ–‡æ ‡é¢˜');
  });
});
```

### 2. Hook æµ‹è¯•

ä½¿ç”¨ `@testing-library/react` çš„ `renderHook` æµ‹è¯•è‡ªå®šä¹‰ Hooksã€‚

```typescript
// ç¤ºä¾‹: useScrollPosition.test.ts
import { renderHook, act } from '@testing-library/react';

describe('useScrollPosition', () => {
  it('should update scroll position', () => {
    const { result } = renderHook(() => useScrollPosition());
    
    act(() => {
      window.scrollTo(0, 300);
      fireEvent.scroll(window);
    });
    
    expect(result.current.showBackToTop).toBe(true);
  });
});
```

### 3. ç»„ä»¶æµ‹è¯•

ä½¿ç”¨ `@testing-library/react` çš„ `render` æµ‹è¯• React ç»„ä»¶ã€‚

```typescript
// ç¤ºä¾‹: StateComponents.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';

describe('ErrorState', () => {
  it('should render error message', () => {
    render(<ErrorState message="Something went wrong" />);
    expect(screen.getByText('Something went wrong')).toBeInTheDocument();
  });

  it('should call onRetry when retry button clicked', () => {
    const onRetry = vi.fn();
    render(<ErrorState message="Error" onRetry={onRetry} />);
    
    fireEvent.click(screen.getByRole('button', { name: /retry/i }));
    expect(onRetry).toHaveBeenCalledOnce();
  });
});
```

## ğŸ“ˆ æµ‹è¯•è¦†ç›–è¯¦æƒ…

### useMarkdownLoader.test.ts (12 tests)

| æµ‹è¯•ç»„ | æµ‹è¯•æ•° | æè¿° |
|--------|--------|------|
| generateHeadingId | 7 | æ ‡é¢˜IDç”Ÿæˆé€»è¾‘ |
| extractTocFromMarkdown | 5 | TOCæå–é€»è¾‘ |

**æµ‹è¯•ç”¨ä¾‹:**
- âœ… è½¬æ¢ä¸ºå°å†™ kebab-case
- âœ… ç§»é™¤ç‰¹æ®Šå­—ç¬¦
- âœ… å¤„ç†ä¸­æ–‡å­—ç¬¦
- âœ… å¤„ç†å¤šä¸ªç©ºæ ¼
- âœ… ç§»é™¤é¦–å°¾è¿å­—ç¬¦
- âœ… å¤„ç†ç©ºå­—ç¬¦ä¸²
- âœ… å¤„ç†çº¯ç¬¦å·å­—ç¬¦ä¸²
- âœ… æå–å¤šçº§æ ‡é¢˜
- âœ… å¤„ç†å†…è”ä»£ç 
- âœ… å¤„ç†HTMLæ ‡ç­¾
- âœ… å¤„ç†ç©ºå†…å®¹
- âœ… å¤„ç†ä»£ç å—å†…çš„å‡æ ‡é¢˜

### useScrollPosition.test.ts (8 tests)

| æµ‹è¯•ç»„ | æµ‹è¯•æ•° | æè¿° |
|--------|--------|------|
| showBackToTop | 4 | è¿”å›é¡¶éƒ¨æŒ‰é’®æ˜¾ç¤ºé€»è¾‘ |
| scrollToTop | 2 | æ»šåŠ¨åˆ°é¡¶éƒ¨åŠŸèƒ½ |
| scrollProgress | 2 | æ»šåŠ¨è¿›åº¦è®¡ç®— |

### useKeyboardShortcuts.test.ts (11 tests)

| æµ‹è¯•ç»„ | æµ‹è¯•æ•° | æè¿° |
|--------|--------|------|
| Home/End keys | 2 | é¡µé¦–/é¡µå°¾å¯¼èˆª |
| Ctrl combinations | 5 | ç»„åˆå¿«æ·é”® |
| Edge cases | 4 | è¾¹ç•Œæƒ…å†µå¤„ç† |

### StateComponents.test.tsx (14 tests)

| ç»„ä»¶ | æµ‹è¯•æ•° | æè¿° |
|------|--------|------|
| LoadingState | 3 | åŠ è½½çŠ¶æ€æ¸²æŸ“ |
| ErrorState | 4 | é”™è¯¯çŠ¶æ€å’Œé‡è¯• |
| EmptyState | 4 | ç©ºçŠ¶æ€å’Œè‡ªå®šä¹‰å†…å®¹ |
| ConnectionStatus | 3 | è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ |

### BackToTopButton.test.tsx (6 tests)

| æµ‹è¯•ç»„ | æµ‹è¯•æ•° | æè¿° |
|--------|--------|------|
| Visibility | 2 | æ˜¾ç¤º/éšè—é€»è¾‘ |
| Click handling | 2 | ç‚¹å‡»äº‹ä»¶å¤„ç† |
| Styling | 2 | æ ·å¼å’ŒåŠ¨ç”» |

### MarkdownViewer.test.tsx (7 tests)

| æµ‹è¯•ç»„ | æµ‹è¯•æ•° | æè¿° |
|--------|--------|------|
| Loading State | 1 | åŠ è½½éª¨æ¶å±æ¸²æŸ“ |
| Error State | 1 | é”™è¯¯çŠ¶æ€æ˜¾ç¤º |
| Empty State | 1 | ç©ºçŠ¶æ€æ˜¾ç¤º |
| Content Render | 1 | å†…å®¹æ¸²æŸ“æˆåŠŸ |
| Interactions | 3 | TOCåˆ‡æ¢ã€è¿”å›é¡¶éƒ¨ã€æ»šåŠ¨è·³è½¬ |

## ğŸš€ è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# è¿è¡Œæµ‹è¯•å¹¶ç›‘è§†å˜åŒ–
pnpm test:watch

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pnpm test:coverage

# è¿è¡Œç‰¹å®šæ–‡ä»¶çš„æµ‹è¯•
pnpm test src/hooks/__tests__/useMarkdownLoader.test.ts

# ä½¿ç”¨UIç•Œé¢è¿è¡Œæµ‹è¯•
pnpm test:ui
```

## ğŸ“ TDD å·¥ä½œæµ

æœ¬é¡¹ç›®éµå¾ª TDD (æµ‹è¯•é©±åŠ¨å¼€å‘) æ–¹æ³•è®ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RED   â”‚ â”€â”€â–¶ â”‚  GREEN  â”‚ â”€â”€â–¶ â”‚ REFACTORâ”‚
â”‚ (Write  â”‚     â”‚ (Make   â”‚     â”‚ (Clean  â”‚
â”‚  test)  â”‚     â”‚  pass)  â”‚     â”‚  code)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                               â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 (Repeat)
```

### æ­¥éª¤è¯´æ˜

1. **RED**: å…ˆç¼–å†™å¤±è´¥çš„æµ‹è¯•
   - æ˜ç¡®åŠŸèƒ½éœ€æ±‚
   - å®šä¹‰é¢„æœŸè¡Œä¸º
   - è¿è¡Œæµ‹è¯•ç¡®è®¤å¤±è´¥

2. **GREEN**: ç¼–å†™æœ€å°‘ä»£ç ä½¿æµ‹è¯•é€šè¿‡
   - å®ç°åŠŸèƒ½
   - ä¸è¿½æ±‚å®Œç¾
   - åªæ±‚æµ‹è¯•é€šè¿‡

3. **REFACTOR**: é‡æ„ä»£ç 
   - æ¶ˆé™¤é‡å¤
   - æ”¹å–„è®¾è®¡
   - ä¿æŒæµ‹è¯•é€šè¿‡

## ğŸ“š ç›¸å…³é“¾æ¥

- [Hooks æ–‡æ¡£](hooks.md)
- [ç»„ä»¶æ–‡æ¡£](frontend.md)
- [é¡¹ç›® README](../../README.md)
